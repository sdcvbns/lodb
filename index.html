<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" /> 
  <title>Ù…Ø´ØºÙ„ Shabak - HLS Ù…Ø¯Ù…Ø¬</title>
  <style>
    /*
    * ----------------------------------------
    * 1. Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® Ø¹Ø¨Ø± CSS
    * ----------------------------------------
    */
    body {
        user-select: none; /* WebKit/Blink */
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE/Edge */
        cursor: default; /* Ù„Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ù…Ø¤Ø´Ø± Ø§Ù„Ù†Øµ */
    }

    :root{
      --bg:#0c131a;
      --panel:#121a24;
      --accent:#00cc99;
      --accent-dark:#00a377;
      --muted:#b3c0c9;
      --radius:16px;
      /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© */
      --sd-color: #5aa9e6;
      --hd-color: #ff9f1c;
      --fhd-color: #e65a5a;
      --soon-color: #7f8c8d; /* Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù‚Ù†ÙˆØ§Øª Soon */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: linear-gradient(180deg, #091016 0%, #0e161f 100%);
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      color:#e6f0ef;
      padding:20px;
      min-height:100vh;
      min-height: 100dvh; 
      overflow-x: hidden;
    }
    .app { 
      max-width:1024px; 
      margin:10px auto; 
      /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø£ØµØ¨Ø­ Ù†Ø¸Ø§Ù… Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙŠÙ…ØªØ¯ Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø±Ø¶ */
      display:block; 
      gap:0; 
      padding: 0;
    }
    @media (max-width:1064px){ 
      /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù„Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠÙ…ØªØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
      .app { margin: 0 auto; }
    }

    .player { 
      background: var(--panel); 
      border-radius:var(--radius); 
      overflow:hidden; 
      box-shadow:0 12px 40px rgba(0,0,0,0.5); 
      position:relative; 
      /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù„Ù…Ù„Ø¡ Ø§Ù„Ø¹Ø±Ø¶ */
      margin: -20px -20px 20px -20px; 
      border-radius: 0;
    }
    @media (min-width:1065px){
      .player {
        margin: 0 0 20px 0;
        border-radius: var(--radius);
      }
    }

    .player .meta { display:flex; justify-content:space-between; align-items:center; padding:14px 20px; gap:10px; border-bottom:1px solid rgba(255,255,255,0.05); }
    .channel-title { font-size:20px; font-weight:700; }
    .meta .controls { display:flex; gap:10px; align-items:center; }

    .video-wrap { 
      position:relative; 
      /* ØªØ¹Ø¯ÙŠÙ„ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø´ØºÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„ÙƒØ¨ÙŠØ±Ø© */
      height: clamp(200px, 50vw, 550px); 
      min-height:280px; 
      background:#000; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      transition: transform .35s; 
    }
    video#mainVideo, iframe#mainIframe { 
      width:100%; 
      height:100%; 
      border:0; 
      display:block; 
      background:#000; 
      object-fit: contain; 
    }

    .big-play { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:6; width:90px;height:90px;border-radius:50%; display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, var(--accent), var(--accent-dark)); box-shadow:0 10px 40px rgba(0,204,153,0.4); cursor:pointer; transition:all .2s; animation:pop 2s infinite;}
    .big-play:hover { box-shadow:0 10px 50px rgba(0,204,153,0.6); transform:translate(-50%,-50%) scale(1.05); }
    @keyframes pop { 0%{transform:translate(-50%,-50%) scale(1)} 50%{transform:translate(-50%,-50%) scale(1.04)} 100%{transform:translate(-50%,-50%) scale(1)} }
    .spinner { position:absolute; z-index:8; left:50%; top:50%; transform:translate(-50%,-50%); width:60px;height:60px;border-radius:50%; display:none; align-items:center;justify-content:center; }
    .spinner.show{ display:flex; animation:spin 1s linear infinite; }
    @keyframes spin{ from{ transform:translate(-50%,-50%) rotate(0) } to{ transform:translate(-50%,-50%) rotate(360deg) } }
    .spinner svg circle { stroke:var(--accent); stroke-dasharray:31.4 31.4; }

    /*
    * ----------------------------------------
    * 2. ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£ÙÙ‚ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    * ----------------------------------------
    */
    .list-container { 
      /* Ø¥Ø²Ø§Ù„Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‡Ø§Ù…Ø´/Ø§Ù„Ø­Ø´Ùˆ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª */
      display: block;
      padding: 0 0 40px; 
    }
    @media (max-width:1064px){
      .list-container {
        /* Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø´Ùˆ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø§Ù„Ø°ÙŠ Ø£Ø²ÙŠÙ„ Ù…Ù† body */
        padding-left: 20px;
        padding-right: 20px;
        padding-bottom: 120px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ù„Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù…ØµØºØ± */
      }
    }
    
    .channels-group {
      margin-bottom: 30px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
      padding: 0; 
      display: flex;
      flex-direction: column;
      gap: 15px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª */
    }
    .channels-group-title {
      font-size: 18px;
      font-weight: 700;
      color: #e6f0ef; /* Ù„ÙˆÙ† Ø£Ø¨ÙŠØ¶ */
      border-bottom: 2px solid rgba(255,255,255,0.05); 
      padding-bottom: 8px;
    }

    /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¬Ø¹Ù„Ù‡ ØªÙ…Ø±ÙŠØ± Ø£ÙÙ‚ÙŠ */
    .channels { 
      display: flex; /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø£ÙÙ‚ÙŠØ§Ù‹ */
      gap: 15px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
      overflow-x: auto; /* ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
      overflow-y: hidden; 
      padding-bottom: 10px; /* Ø­Ø´Ùˆ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¸Ù‡ÙˆØ± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    }
    /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
    .channels::-webkit-scrollbar {
        height: 6px;
    }
    .channels::-webkit-scrollbar-thumb {
        background: var(--accent-dark);
        border-radius: 3px;
    }
    .channels::-webkit-scrollbar-track {
        background: var(--panel);
        border-radius: 3px;
    }
    
    .channel { 
      background:var(--panel); 
      padding:16px; 
      border-radius:12px; 
      display:flex; 
      flex-direction: column;
      gap:8px; 
      align-items:center;
      text-align: center;
      transition: transform .2s ease, background .2s; 
      cursor:pointer; 
      border:2px solid transparent;
      
      /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
      width: 130px; 
      min-width: 130px; /* Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù†ÙƒÙ…Ø§Ø´Ù‡Ø§ */
      height: 100%; 
      flex-shrink: 0; /* Ù…Ù†Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© */
      box-shadow:0 4px 10px rgba(0,0,0,0.3);
    }
    .channel:hover{ 
      transform:translateY(-3px); 
      box-shadow:0 8px 20px rgba(0,0,0,0.4); 
      background:rgba(255,255,255,0.05); 
    }
    .channel.active { 
      border-color:var(--accent); 
      background:rgba(0,204,153,0.1); 
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù‚Ù†ÙˆØ§Øª Soon */
    .channel.soon {
      opacity: 0.6;
      cursor: default;
      background: rgba(127, 140, 141, 0.1);
      border-color: var(--soon-color);
    }
    .channel.soon:hover {
      transform: none;
      box-shadow: none;
      background: rgba(127, 140, 141, 0.15);
    }

    .left { 
      width:48px;
      height:48px;
      border-radius:50%; 
      background:var(--accent); 
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:var(--bg); 
      font-size:16px;
      border:none; 
      box-shadow:0 4px 10px rgba(0,204,153,0.4); 
      flex-shrink: 0; 
    }
    .info { 
      flex:1; 
      display:flex; 
      flex-direction:column; 
      gap:4px;
      align-items: center; 
    }
    .title { font-weight:600; font-size:16px }
    .meta { color:var(--muted); font-size:13px; display:block; }

    .actions { display:none; }
    .heart { display:none; } 

    .btn { background:var(--accent); color:var(--bg); padding:8px 14px; border-radius:8px; font-weight:600; font-size:14px; border:none; cursor:pointer; transition:background .2s, transform .1s; box-shadow:0 3px 6px rgba(0,0,0,0.3); }
    .btn:hover { background:var(--accent-dark); transform:translateY(-1px); box-shadow:0 5px 8px rgba(0,0,0,0.4); }
    .btn#btnStop { background:#ff5252; }
    .btn#btnStop:hover { background:#d43c3c; }
    /* Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© */
    .btn#btnExitFs { display: none; }


    .mobile-player-mini { display:none; }
    @media (max-width:1064px){ 
      .mobile-player-mini{ 
        display:block; 
        position:fixed; 
        left:20px; 
        right:20px; 
        bottom:20px; 
        z-index:100; 
        background:var(--panel); 
        padding:12px; 
        border-radius:16px; 
        box-shadow:0 10px 40px rgba(0,0,0,0.6); 
        border:1px solid rgba(255,255,255,0.1); 
      } 
    }
    .fade-in { animation:fadeIn .5s ease both }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }

    /*
    * ----------------------------------------
    * 3. ØªØµÙ…ÙŠÙ… Ù…Ø±Ø¨Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø© (Quality Modal)
    * ----------------------------------------
    */
    .quality-modal {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .quality-modal.show {
        display: flex;
        opacity: 1;
    }
    .quality-content {
        background: var(--panel);
        padding: 30px;
        border-radius: var(--radius);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        max-width: 400px;
        width: 90%;
        text-align: center;
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }
    .quality-modal.show .quality-content {
        transform: scale(1);
    }
    .quality-content h3 {
        margin-top: 0;
        font-size: 22px;
        color: var(--accent);
    }
    .quality-options {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
    }
    .quality-option {
        width: 100%;
        padding: 15px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, opacity 0.2s;
        border: none;
        color: var(--bg);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .quality-option:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }

    .quality-option[data-quality="SD"] { background: var(--sd-color); }
    .quality-option[data-quality="HD"] { background: var(--hd-color); }
    .quality-option[data-quality="FHD"] { background: var(--fhd-color); }

    .quality-cancel {
        margin-top: 20px;
        background: transparent;
        color: var(--muted);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    .quality-cancel:hover {
        background: rgba(255, 255, 255, 0.05);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0"></script>
</head>
<body>
  <div class="app fade-in">
    <div class="player" id="playerWrap">
      <div class="meta">
        <div style="display:flex;align-items:center;gap:12px">
          <div class="channel-title" id="currentTitle">Ø§Ø®ØªÙØ± Ù‚Ù†Ø§Ø© Ù„ØªØ´ØºÙŠÙ„Ù‡Ø§</div>
          <div style="color:var(--muted);font-size:14px" id="currentNumber"></div>
        </div>
        <div class="controls">
          <button class="btn" id="btnExitFs" title="Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">Ø®Ø±ÙˆØ¬ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button> 
          <button class="btn" id="btnStop" title="Ø¥ÙŠÙ‚Ø§Ù">Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
      </div>

      <div class="video-wrap" id="videoWrap" aria-live="polite">
        <div class="spinner" id="spinner" aria-hidden="true">
          <svg width="60" height="60" viewBox="0 0 50 50">
            <circle cx="25" cy="25" r="20" stroke-width="4" stroke-linecap="round" fill="none" stroke-dasharray="31.4 31.4" ></circle>
          </svg>
        </div>

        <div class="big-play" id="bigPlay" title="Ø´ØºÙ‘Ù„ Ø§Ù„Ù‚Ù†Ø§Ø©">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#041017" stroke-width="1.2">
            <path d="M5 3v18l15-9L5 3z" fill="#0c131a" ></path>
          </svg>
        </div>

        <video id="mainVideo" playsinline webkit-playsinline controls></video>
        <iframe id="mainIframe" allowfullscreen="true" frameborder="0" height="100%" scrolling="1" src="" style="display:none"></iframe>
      </div>
    </div>

    <div id="channelsList" class="list-container fade-in" style="animation-delay:.08s">
        </div>
  </div>

  <div class="mobile-player-mini" id="mobileMini" style="display:none">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div>
        <div id="miniTitle" style="font-weight:700"></div>
        <div style="font-size:13px;color:var(--muted)" id="miniNum"></div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="miniStop">Ø¥ÙŠÙ‚Ø§Ù</button>
      </div>
    </div>
  </div>

  <div class="quality-modal" id="qualityModal">
    <div class="quality-content">
      <h3 id="modalChannelTitle">Ø§Ø®ØªØ± Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù‚Ù†Ø§Ø©: Shabak Sport 1</h3>
      <div class="quality-options" id="qualityOptions">
        </div>
      <button class="quality-cancel" id="cancelQuality">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>

<script>
  // ---------------- CONFIG: Ø¶Ø¹ Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡Ù†Ø§ ÙÙŠ url ----------------
  const allChannels = [
    // Shabak Sport 1-8
    { id:1, name:"Shabak Sport 1", links: { SD:"https://stream.supertv.gg:3001/supertv/sport/stv1/ch1/ch1_240.m3u8", HD:"https://stream.supertv.gg:3001/supertv/sport/stv1/ch1/ch1_480.m3u8", FHD:"https://stream.supertv.gg:3001/supertv/sport/stv1/ch1/ch1_720.m3u8" }, category: 'Sport' },
    { id:2, name:"Shabak Sport 2", links: { SD:"https://stream.supertv.gg:3002/supertv/sport/stv2/ch2/ch2_240.m3u8", HD:"https://stream.supertv.gg:3002/supertv/sport/stv2/ch2/ch2_480.m3u8", FHD:"https://stream.supertv.gg:3002/supertv/sport/stv2/ch2/ch2_720.m3u8" }, category: 'Sport' },
    { id:3, name:"Shabak Sport 3", links: { SD:"https://live.asset.televika.com/9c0354b9d93f1e2c123c8d88b4a4f2a7/tvhls/varzeshhdfootbali_s1_480p/index.m3u8", HD:"https://live.asset.televika.com/9c0354b9d93f1e2c123c8d88b4a4f2a7/tvhls/varzeshhdfootbali_s1_720p/index.m3u8", FHD:"https://live.asset.televika.com/9c0354b9d93f1e2c123c8d88b4a4f2a7/tvhls/varzeshhdfootbali_s1_1080p/index.m3u8" }, category: 'Sport' },
    { id:4, name:"Shabak Sport 4", links: { SD:"https://wo.cma.footballii.ir/hls2/tv3_480.m3u8", HD:"https://wo.cma.footballii.ir/hls2/tv3.m3u8", FHD: "" }, category: 'Sport' }, 
    { id:5, name:"Shabak Sport 5", links: { SD:"https://alpha.tv.online.tm/hls/ch000_400/index.m3u8", HD:"https://alpha.tv.online.tm/hls/ch000_720/index.m3u8", FHD: "https://alpha.tv.online.tm/hls/ch000_1080/index.m3u8" }, category: 'Sport' },
    { id:6, name:"Shabak Sport 6", links: { SD:"https://ncdn.telewebion.com/sport1/live/playlist_480.m3u8", HD:"https://ncdn.telewebion.com/sport1/live/playlist.m3u8", FHD: "" }, category: 'Sport' },
    { id:7, name:"Shabak Sport 7", links: { SD:"https://wo.cma.footballii.ir/hls2/solh_480.m3u8", HD:"https://wo.cma.footballii.ir/hls2/solh.m3u8", FHD: "" }, category: 'Sport' },
    { id:8, name:"Shabak Sport 8", links: { SD:"https://live-azd1108.telewebion.com/ek/sport1/live/480p/index.m3u8", HD:"https://live-azd1108.telewebion.com/ek/sport1/live/720p/index.m3u8", FHD: "" }, category: 'Sport' },
    // Shabak Aflam 1-4
    { id:9, name:"Shabak Aflam 1", links: { SD:"https://shls-live-enc.edgenextcdn.net/out/v1/f6d718e841f8442f8374de47f18c93a7/index_sd.m3u8", HD:"https://shls-live-enc.edgenextcdn.net/out/v1/f6d718e841f8442f8374de47f18c93a7/index.m3u8", FHD:"" }, category: 'Aflam' },
    { id:10, name:"Shabak Aflam 2", links: { SD:"https://shls-live-enc.edgenextcdn.net/out/v1/948c54279b594944adde578c95f1d7d1/index_sd.m3u8", HD:"https://shls-live-enc.edgenextcdn.net/out/v1/948c54279b594944adde578c95f1d7d1/index.m3u8", FHD:"" }, category: 'Aflam' },
    { id:11, name:"Shabak Aflam 3", links: { SD:"https://shls-live-enc.edgenextcdn.net/out/v1/46079e838e65490c8299f902a7731168/index_sd.m3u8", HD:"https://shls-live-enc.edgenextcdn.net/out/v1/46079e838e65490c8299f902a7731168/index.m3u8", FHD:"" }, category: 'Aflam' },
    { id:12, name:"Shabak Aflam 4", links: { SD:"", HD:"", FHD:"" }, category: 'Aflam' },
    // Soon 1-5
    { id:13, name:"Soon 1", links: { SD:"", HD:"", FHD:"" }, category: 'Soon' },
    { id:14, name:"Soon 2", links: { SD:"", HD:"", FHD:"" }, category: 'Soon' },
    { id:15, name:"Soon 3", links: { SD:"", HD:"", FHD:"" }, category: 'Soon' },
    { id:16, name:"Soon 4", links: { SD:"", HD:"", FHD:"" }, category: 'Soon' },
    { id:17, name:"Soon 5", links: { SD:"", HD:"", FHD:"" }, category: 'Soon' },
  ];

  // Ø¯Ø§Ù„Ø© Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
  const groupedChannels = allChannels.reduce((acc, channel) => {
    const category = channel.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(channel);
    return acc;
  }, {});
  // ----------------------------------------------------------------------

  const listEl = document.getElementById('channelsList');
  const video = document.getElementById('mainVideo');
  const iframe = document.getElementById('mainIframe');
  const spinner = document.getElementById('spinner');
  const bigPlay = document.getElementById('bigPlay');
  const currentTitle = document.getElementById('currentTitle');
  const currentNumber = document.getElementById('currentNumber');
  const mobileMini = document.getElementById('mobileMini');
  const miniTitle = document.getElementById('miniTitle');
  const miniNum = document.getElementById('miniNum');
  const btnStop = document.getElementById('btnStop');
  // ØªÙ… Ø¥Ù„ØºØ§Ø¡ countTxt Ù„Ø£Ù†Ù‡ Ù„Ù… ÙŠØ¹Ø¯ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù€ UI
  // const countTxt = document.getElementById('countTxt');

  // Ø¹Ù†Ø§ØµØ± Ù…Ø±Ø¨Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø©
  const qualityModal = document.getElementById('qualityModal');
  const modalChannelTitle = document.getElementById('modalChannelTitle');
  const qualityOptionsEl = document.getElementById('qualityOptions');
  const cancelQualityBtn = document.getElementById('cancelQuality');

  let favs = JSON.parse(localStorage.getItem('shabak_favs') || '[]');
  let last = JSON.parse(localStorage.getItem('shabak_last') || 'null');
  let selectedChannelForQuality = null; 

  function saveFavs(){ localStorage.setItem('shabak_favs', JSON.stringify(favs)); }
  function saveLast(){ localStorage.setItem('shabak_last', JSON.stringify(last)); }
  
  // 1. Ù…Ù†Ø¹ Ø²Ø± Ø§Ù„ÙØ£Ø±Ø© Ø§Ù„Ø£ÙŠÙ…Ù† (Context Menu) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript
  document.addEventListener('contextmenu', e => e.preventDefault());


  // create channel item
  function createChannelItem(ch){
    const item = document.createElement('div');
    item.className = 'channel';
    item.setAttribute('data-id', ch.id);
    if(last && last.id === ch.id) item.classList.add('active');
    
    // Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© 'soon' Ù„Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø±
    if (ch.category === 'Soon') {
        item.classList.add('soon');
    }

    const left = document.createElement('div'); left.className = 'left'; left.textContent = ch.id;
    const info = document.createElement('div'); info.className='info';
    const t = document.createElement('div'); t.className='title'; t.textContent = ch.name;
    const m = document.createElement('div'); 
    m.className='meta'; 
    m.textContent = ch.category === 'Soon' ? 'Ù‚Ø±ÙŠØ¨Ø§Ù‹' : 'Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø©';
    info.appendChild(t); info.appendChild(m);

    // ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¹Ø¨Ø± CSS
    const actions = document.createElement('div'); actions.className='actions';
    const heart = document.createElement('button');
    heart.className='heart'; heart.setAttribute('aria-label','Ø§Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©');
    heart.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.4"><path d="M20.8 7.6c0 5.6-9 11.4-9 11.4S2.8 13.2 2.8 7.6a4.2 4.2 0 017.3-3 4.2 4.2 0 017.3 3z"></path></svg>';
    if (favs.includes(ch.id)) heart.classList.add('active');

    heart.addEventListener('click', (e)=>{
      e.stopPropagation();
      if(favs.includes(ch.id)){ favs = favs.filter(x=>x!==ch.id); heart.classList.remove('active'); }
      else { favs.push(ch.id); heart.classList.add('active'); }
      saveFavs();
    });
    actions.appendChild(heart);
    item.appendChild(left); item.appendChild(info); item.appendChild(actions);

    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
    item.addEventListener('click', ()=>{
        if (ch.category === 'Soon') return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ø§Ù‹ Ù„Ù‚Ù†ÙˆØ§Øª Soon
        document.querySelectorAll('.channel').forEach(c=>c.classList.remove('active'));
        item.classList.add('active');
        showQualityModal(ch);
    });

    return item;
  }
  
  // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  function renderList(){
    listEl.innerHTML = '';
    
    // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙØ¦Ø§Øª
    const categoryTitles = {
      Sport: 'Ù‚Ù†ÙˆØ§Øª Shabak Sport (1-8)',
      Aflam: 'Ù‚Ù†ÙˆØ§Øª Shabak Aflam (1-4)',
      Soon: 'Ù‚Ù†ÙˆØ§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹ (Soon)',
    };

    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø±Ø¶
    const categoriesOrder = ['Sport', 'Aflam', 'Soon'];
    
    let totalChannels = 0;

    categoriesOrder.forEach(category => {
        const groupChannels = groupedChannels[category];
        if (groupChannels && groupChannels.length > 0) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            const groupWrap = document.createElement('div');
            groupWrap.className = 'channels-group';

            // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
            const titleEl = document.createElement('div');
            titleEl.className = 'channels-group-title';
            titleEl.textContent = categoryTitles[category] || category;
            groupWrap.appendChild(titleEl);
            
            // Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙÙŠ Ø´ÙƒÙ„ ØªÙ…Ø±ÙŠØ± Ø£ÙÙ‚ÙŠ
            const channelsContainer = document.createElement('div');
            channelsContainer.className = 'channels';
            
            groupChannels.forEach(ch => {
                channelsContainer.appendChild(createChannelItem(ch));
                totalChannels++;
            });
            
            groupWrap.appendChild(channelsContainer);
            listEl.appendChild(groupWrap);
        }
    });

    // ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    // countTxt.textContent = totalChannels + " Ù‚Ù†Ø§Ø©";
    setTimeout(()=> document.querySelectorAll('.channel:not(.soon)').forEach(c=>c.setAttribute('tabindex','0')), 50);
  }

  renderList();

  let hlsInstance = null;
  let loadingTimeout = null;

  function isHlsUrl(url){
    if(!url) return false;
    return url.includes('.m3u8') || /m3u8/.test(url);
  }

  // Ø¯Ø§Ù„Ø© playChannel Ø§Ù„Ø¢Ù† ØªØªÙ„Ù‚Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ÙƒØ§Ø¦Ù† Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ÙƒØ§Ù…Ù„
  function playChannel(ch, url, qualityText){
    // UI updates
    spinner.classList.add('show');
    bigPlay.style.display = 'none';
    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´ØºÙ„ Ù„ÙŠØ´Ù…Ù„ Ø§Ù„Ø¬ÙˆØ¯Ø©
    currentTitle.textContent = `${ch.name} (${qualityText})`; 
    currentNumber.textContent = ' | ' + ch.id;
    miniTitle.textContent = `${ch.name} (${qualityText})`;
    miniNum.textContent = ch.id;
    mobileMini.style.display = window.innerWidth <= 1064 ? 'block' : 'none';

    // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø®ÙŠØ± ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© Ù„Ù€ bigPlay
    last = { id: ch.id, name: ch.name, time: (new Date()).toISOString(), lastUrl: url, lastQuality: qualityText };
    saveLast();

    const finalUrl = url && url.trim() ? url.trim() : '';

    // stop any existing playback & cleanup
    cleanupPlayback();

    if (isHlsUrl(finalUrl)) {
      iframe.style.display = 'none';
      video.style.display = 'block';
      video.controls = true;

      const canNative = video.canPlayType('application/vnd.apple.mpegurl') !== '';
      if (canNative) {
        video.src = finalUrl;
        tryAutoPlayVideo();
      } else if (window.Hls && Hls.isSupported()) {
        hlsInstance = new Hls({ 
          maxBufferLength: 30,
          liveSyncDurationCount: 3,
          backBufferLength: 20
        });
        hlsInstance.loadSource(finalUrl);
        hlsInstance.attachMedia(video);
        hlsInstance.on(Hls.Events.MANIFEST_PARSED, function() {
          tryAutoPlayVideo();
        });
        hlsInstance.on(Hls.Events.ERROR, function(event, data) {
          console.error('HLS error', event, data);
          if (data && data.fatal) {
            try { hlsInstance.destroy(); } catch(e){}
            fallbackToIframe(finalUrl);
          }
        });
      } else {
        fallbackToIframe(finalUrl);
      }
    } else if (finalUrl) {
      fallbackToIframe(finalUrl);
    } else {
      spinner.classList.remove('show');
      bigPlay.style.display = 'flex';
      currentTitle.textContent = `${ch.name} (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆØ¯Ø©)`;
      currentNumber.textContent = ''; // Ù…Ø³Ø­ Ø±Ù‚Ù… Ø§Ù„Ù‚Ù†Ø§Ø©
      video.style.display = 'none';
      iframe.style.display = 'none';
    }
    
    // ğŸŒŸğŸŒŸğŸŒŸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ù‚Ù†ÙˆØ§Øª Aflam ÙˆØºÙŠØ±Ù‡Ø§: Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø®Ø·Ø£ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„ØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ iframe ğŸŒŸğŸŒŸğŸŒŸ
    // ÙŠØ¶Ù…Ù† Ù‡Ø°Ø§ Ø£Ù† Ø£ÙŠ ÙØ´Ù„ ÙÙŠ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£ØµÙ„ÙŠ (Ø³ÙˆØ§Ø¡ HLS Ø£Ùˆ ØºÙŠØ±Ù‡) Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… iframe
    video.onerror = function() {
        console.error('Video element error occurred. Falling back to iframe.');
        fallbackToIframe(finalUrl);
        video.onerror = null; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
    };
    // ğŸŒŸğŸŒŸğŸŒŸ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ğŸŒŸğŸŒŸğŸŒŸ
    
    if (loadingTimeout) clearTimeout(loadingTimeout);
    loadingTimeout = setTimeout(()=>{ spinner.classList.remove('show'); }, 12000);
  }

  function fallbackToIframe(url){
    try { video.pause(); video.removeAttribute('src'); video.load(); } catch(e){}
    if (hlsInstance){ try { hlsInstance.destroy(); } catch(e){} hlsInstance = null; }
    iframe.style.display = 'block';
    video.style.display = 'none';
    iframe.src = url && url.length ? url : 'about:blank';
  }

  function tryAutoPlayVideo(){
    video.play().then(()=> {
      spinner.classList.remove('show');
    }).catch(err => {
      console.warn('Autoplay blocked or failed (needs user interaction for audio):', err);
      video.addEventListener('loadeddata', function onld(){
        spinner.classList.remove('show');
        video.removeEventListener('loadeddata', onld);
      });
      bigPlay.style.display = 'flex';
    });
  }

  // cleanup any prior playback
  function cleanupPlayback(){
    spinner.classList.remove('show');
    if (hlsInstance){ try { hlsInstance.destroy(); } catch(e){} hlsInstance = null; }
    try { video.pause(); video.removeAttribute('src'); video.load(); } catch(e){}
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† src Ù„Ù„Ø¥Ø·Ø§Ø±
    iframe.src = 'about:blank';
    // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø®Ø·Ø£ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø±Ù‡
    video.onerror = null; 
  }

  // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø©
  function showQualityModal(ch) {
    selectedChannelForQuality = ch;
    modalChannelTitle.textContent = `Ø§Ø®ØªØ± Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù‚Ù†Ø§Ø©: ${ch.name}`;
    qualityOptionsEl.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

    const qualities = { SD: "SD", HD: "HD", FHD: "FHD" };
    const qualityNames = { SD: "Ø¬ÙˆØ¯Ø© Ø¹Ø§Ø¯ÙŠØ© (SD)", HD: "Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© (HD)", FHD: "Ø¬ÙˆØ¯Ø© ÙƒØ§Ù…Ù„Ø© (FHD)" };
    
    let hasValidLink = false;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©
    Object.entries(qualities).forEach(([key, value]) => {
      const url = ch.links[key];
      if (url) {
        hasValidLink = true;
        const btn = document.createElement('button');
        btn.className = 'quality-option';
        btn.setAttribute('data-quality', key);
        btn.textContent = qualityNames[key];
        
        btn.addEventListener('click', () => {
          // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØªØ§Ø± ÙˆÙ†Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©
          playChannel(ch, url, value);
          hideQualityModal();
        });
        qualityOptionsEl.appendChild(btn);
      }
    });

    if (!hasValidLink) {
        qualityOptionsEl.innerHTML = '<p style="color:var(--fhd-color); font-weight:600;">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ù†Ø§Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
    }

    qualityModal.classList.add('show');
  }

  function hideQualityModal() {
    qualityModal.classList.remove('show');
    selectedChannelForQuality = null;
  }

  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡
  cancelQualityBtn.addEventListener('click', hideQualityModal);
  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  qualityModal.addEventListener('click', (e) => {
    if (e.target === qualityModal) {
      hideQualityModal();
    }
  });


  // bigPlay: resume last or first (ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹)
  bigPlay.addEventListener('click', ()=>{
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŒ ÙˆØ¥Ù„Ø§ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ØºÙŠØ± Soon
    const ch = last ? allChannels.find(c=>c.id===last.id) : allChannels.find(c => c.category !== 'Soon');

    if (ch && ch.category !== 'Soon') {
        document.querySelectorAll('.channel').forEach(c=>c.classList.remove('active'));
        document.querySelector(`.channel[data-id="${ch.id}"]`)?.classList.add('active');
        
        if (last && last.lastUrl) {
            // ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸
            playChannel(ch, last.lastUrl, last.lastQuality || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
        } else {
             // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¬ÙˆØ¯Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ ØªØ´ØºÙŠÙ„ Ø³Ø§Ø¨Ù‚ Ù…Ø­ÙÙˆØ¸
            showQualityModal(ch);
        }
    } else if (ch) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù‡ÙŠ Soon Ø£Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ù†Ø§Ø© Ù…ØªØ§Ø­Ø©
        currentTitle.textContent = 'Ø§Ø®ØªÙØ± Ù‚Ù†Ø§Ø© Ù„ØªØ´ØºÙŠÙ„Ù‡Ø§';
        currentNumber.textContent = '';
        bigPlay.style.display = 'flex';
    }
  });

  // hide spinner when video/iframe loaded
  video.addEventListener('playing', ()=> spinner.classList.remove('show'));
  video.addEventListener('loadeddata', ()=> spinner.classList.remove('show'));
  iframe.addEventListener('load', ()=> spinner.classList.remove('show'));

  btnStop.addEventListener('click', stopPlayer);
  document.getElementById('miniStop').addEventListener('click', stopPlayer);
  function stopPlayer(){
    cleanupPlayback();
    iframe.style.display = 'none';
    video.style.display = 'none';
    currentTitle.textContent = 'ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù';
    currentNumber.textContent = '';
    mobileMini.style.display = 'none';
    bigPlay.style.display = 'flex';
    document.querySelectorAll('.channel').forEach(c=>c.classList.remove('active'));
    try { if (document.fullscreenElement) document.exitFullscreen(); } catch(e){}
  }


  // restore last UI placeholder
  if (last && last.id){
    currentTitle.textContent = last.name;
    currentNumber.textContent = ' | ' + last.id;
    bigPlay.style.display = 'flex';
    document.querySelector(`.channel[data-id="${last.id}"]`)?.classList.add('active');
  }

  // keyboard & accessibility (ØªØºÙŠÙŠØ± Ø§Ù„ØªÙ†Ù‚Ù„ Ù„ÙŠÙƒÙˆÙ† Ø£ÙÙ‚ÙŠÙ‹Ø§ Ø¨Ø§Ù„Ø³Ù‡Ø§Ù… Ø§Ù„ÙŠÙ…Ù†Ù‰ ÙˆØ§Ù„ÙŠØ³Ø±Ù‰)
  document.addEventListener('keydown', (e)=>{
    if (qualityModal.classList.contains('show')) return; 

    const focusable = Array.from(document.querySelectorAll('.channel:not(.soon)')); 
    const idx = focusable.indexOf(document.activeElement);
    if (e.key === 'ArrowRight'){ 
        e.preventDefault(); 
        const next = focusable[idx+1] || focusable[0]; 
        if(next) next.focus(); 
    }
    else if (e.key === 'ArrowLeft'){ 
        e.preventDefault(); 
        const prev = focusable[idx-1] || focusable[focusable.length-1]; 
        if(prev) prev.focus(); 
    }
    else if (e.key === 'Enter' && document.activeElement.classList.contains('channel')) document.activeElement.click();
  });

  window.addEventListener('resize', ()=> { if (window.innerWidth > 1064) mobileMini.style.display = 'none'; });

  // initialize UI
  if (allChannels.length > 0) {
    renderList();
  }

</script>
</body>
</html>